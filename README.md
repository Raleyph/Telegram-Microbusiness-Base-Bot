# Telegram Microbusiness Base Bot
Бот для ведения базы клиентов, записей и расходов микропредприятия. Может создавать графики дохода и времени работы, а также представлять сведения в виде таблиц. Также есть функция вычисления рентабельности и чистой прибыли. Имеет единую базу для всех пользователей, следовательно, может использоваться работниками одной компании или конкретным человеком.

Примеры сфер, где может использоваться данный бот: парикмахерская, салон красоты, ремонт техники, автосервис.

Актуальная версия: 2.1
## Технические особенности
Работает на основе асинхронной библиотки **aiogram**. Присутствует машина состояний (конечные автоматы). Хранит данные в БД **sqlite3**. Создание датафреймов реализовано с помощью **pandas**, а их графическое представление с помощью **plotly**. Для конвертации датафрейма в Excel файл нужно установить модуль **openpyxl**. Каждую неделю бот отправляет пользователю сведения о доходе посредством библиотеки **aioschedule**. Остальные функции выполнены посредством стандартных билиотек.
## Функционал
Возможности бота:
- Сохранение клиента в базу данных и его редактирование
- Сохранение даты и времени записи для конкретного клиента
- Сохранение данных о расходах
- Получение всех вышеуказанных данных в виде таблиц
- Представление данных о доходе и времени работы в виде линейного графика и гистограммы в зависимости от временного промежутка
- Подсчет рентабельности
## Клиенты
Для клиента можно указать следующую информацию: имя, краткое описание и контакты. Также клиент содержит параметр **Количество посещений**. Он увеличивается при завершении записи, относящейся к конкретному клиенту.

Чтобы добавить клиента существует кнопка **Добавить клиента** в меню клиентов. Все три параметра являются строками, принимающие данные до 22 символов для имени и 30 символов для описания по умолчанию.

После добавления клиента, удалить его без изменения файла базы данных невозможно. Его можно только редактировать. Нажав кнопку **Редактировать** клиента в меню клиента пользователю будет предложено выбрать клиента из списка. Далее его попросят ввести новое имя, описание или контактные данные. Если какой-то из параметров изменять не нужно, то существует кнопка **Пропустить**.

Кнопка **Список клиентов** в меню клиентов выводит список клиентов в виде таблицы.
## Записи
Чтобы добавить запись в меню записей есть кнопка **Добавить запись**. Новая запись принимает два параметра: дата-время и клиент. Дата и время указываются в вормате ***ГГГГ-ММ-ЧЧ ЧЧ:ММ***. Указать можно толкьо сегодняшнюю и последующие даты, - добавить дату "задним числом" не получится. Если дата и время уже заняты, то бот сообщит вам об этом. Клиент выбирается пользователем из списка.

Незавершенную хапись можно удалть, нажав на кнопку **Удалить запись** в меню записей. Бот попросит выбрать конретную запись для удаления и, затем, подтвердить операцию.

Кнопка **Текущие записи** в меню записей выводит график на эту неделю с указанием дней недели и часов работы. По умолчанию с 09:00 до 20:00.

После обслущивания клиента запись необходимо завершить. Чтобы это сделать существует кнопка **Завершить запись**. После ее нажатия нужно выбрать конкретную запись для завершения. Далее бот попросит ввести следующие данные: услуга, стоимость, *чаевые*, *дополнительная информация*, время работы. Курсивом помечены необязательные параметры.
## Аналитика
В меню аналитики есть следующие кнопки:
- График дохода
- График времни
- Завершенные записи
- Общие данные

Первые три содержат в себе еще три кнопки:
- За неделю
- За месяц
- За все время

Возвращаемое представление данных для каждого набора параметров:

| Промежуток | График дохода | График времени | Завершенные записи |
| --- | :---: | :---: | :---: |
| **За неделю** | Линейный график | Линейный график | Таблица |
| **За месяц** | Линейный график | Линейный график | Таблица |
| **За все время** | Гистограмма | Гистограмма | Файл .xlsx |

Кнопка **Общие данные** открывает меню, которое содержит следующие кнопки:
- Общий доход
- Расходы
- Рентабельность

Кнопка **Общий доход** выводит все указанные доходы и чаевые из таблицы записей, а также их сумму.

Кнопка **Расходы** открывает меню, которое содержит в себе следующие кнопки:
- Добавить расход
- Удалить расход
- Список расходов

Расход имеет следующие параметры: стоимость, дата и тип расхода. От последнего зависят дополнительные параметры.

| Параметр | Материал | Зарплата | Перевозка | Налог |
| --- | :---: | :---: | :---: | :---: |
| **ID** | ✓ | ✓ | ✓ | ✓ |
| **Дата** | ✓ | ✓ | ✓ | ✓ |
| **Стоимость** | ✓ | ✓ | ✓ | ✓ |
| **Описание** | | ✓ | ✓ | ✓ |
| **Название** | ✓ | | | |
| **Количество** | ✓ | | | |
| **Расход** | ✓ | | | |

Чтобы подсчитать рентабельность есть кнопка **Рентабельность**. Она считается по следующей формуле:

$$ Рентабельность = {{Прибыль-Расход} \over Прибыль}*100% $$

Обратите внимание, что рентабельность считается по данным за промежуток времени от даты последней крупной закупки до сегодняшнего дня. Крупная закупка определяется датой, на которую записано большое количество расходов. Прибыль также определяется за данный промежуток времени.
